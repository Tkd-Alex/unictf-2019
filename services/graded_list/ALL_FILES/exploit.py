import random
import string
import sys
from pwn import *



def randomString(stringLength=6):
    """Generate a random string of fixed length """
    letters = string.ascii_letters
    return ''.join(random.choice(letters) for i in range(stringLength))

def calc_sum2(a, b, c):
	return int(a+b-c)

def calc_sum1(a, b):
	a = "AAAA"+a
	b = "BBBB"+b
	res = 0
	if len(a) < len(b):
		c = b
		b = a
		a = c
	for i, c in enumerate(a):
		if i < len(b):
			res += ord(a[i])^ord(b[i])
		else:
			res += 0
	return res

def generate():
	sum1 = 0
	sum2 = 0

	while 1 == 1:
		x = 255
		y = 255
		z = 0

		str1 = randomString(10)
		str2 = randomString(10)
		sum2 = calc_sum2(x, y, z)
		sum1 = calc_sum1(str1, str2)
		sum3 = sum1+sum2
		if sum3 == 1069:
			print("Score: " + str(sum3) + " with: " + str(x) + " " + str(y) + " " + str(z))
			print("And Strings: " + str1 + " " + str2 + '\n')
			return x, y, z, str1, str2

def retrieve_flag(str1, str2, addr, x=255, y=255, z=0):
	port = 38960
	s = remote(addr, port)	
	res = s.readuntil('> ')
	s.send(str1+'\n')
	res = s.readuntil('> ')
	s.send(str2+'\n')
	res = s.readuntil('> ')
	s.send(str(z)+'\n')
	res = s.readuntil('> ')
	s.send(str(x)+'\n')
	res = s.readuntil('> ')
	s.send(str(y)+'\n')
	res = s.readall()
	print(res)
	res2 = res.splitlines()
	res2 = filter(lambda x: 'unictf{' in x, res2)
	flag = None
	if res2:
		print("Founded Flag: " + res2[0])
		flag = res2[0]
	else:
		print("Flag not found")
	return flag

def main():
	addr = "192.168.10.28"
	flag = ''
	x, y, z, str1, str2 = generate()
	flag = retrieve_flag(str1, str2, addr, x, y, z)

if __name__ == '__main__':
    main()

